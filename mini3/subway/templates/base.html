{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}기본 타이틀{% endblock %}</title>
    <link rel="stylesheet" type="text/css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        @font-face {
            font-family: 'BMJUA';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_one@1.0/BMJUA.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }
        nav {
            max-width: 500px;
            margin: 0 auto;
            background-color: rgb(235, 238, 243);
            border-radius: 10px;
            align-items: center;
            transform: translateY(-55%);
            box-shadow: 3px 3px 7px rgb(183, 185, 185), -3px -3px 7px rgb(183, 185, 185);
            z-index: 1000;
            position: fixed;
            top: 15.5%;
            left: 34%;
        }
        
        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgb(255, 226, 236);
            padding-bottom: 25px;
        }
        .header img {
            width: 30px;
        }
        .controls {
            top: 250px;
            right: 20px;
            display: flex;
            flex-direction: column;
            z-index: 10000;
            position: fixed;
        }
        .image-container {
            width: 1928px;
            height: 1565px;
            max-width: 100%;
            max-height: 80vh;
            overflow: hidden;
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translateY(0%);
            z-index: 1;
        }
        .map-image {
            display: block;
            max-width: none;
            height: auto;
            width: 110%;
            transition: width 0.5s, transform 0.5s;
            position: absolute;
            object-fit: contain;
            top: 50%;
            left: 50%;
            transform: translate(-60%, -43%);
        }
        .map-image:active {
            cursor: grabbing;
        }
        .train-marker {
            position: absolute;
            width: 50px;
            height: 50px;
            background-size: contain;
            z-index: 1000;
            transition: transform 0.01s;
        }
    </style>
    {% block style %}
    {% endblock %}
    
</head>

<body>
    <header class="header" style="font-family: 'BMJUA';">
        <h1>
            <img src="{% static 'subway/루피left.png' %}" alt="루피 left">
            <span>당당루피즈 지하철 노선도</span>
            <img src="{% static 'subway/루피right.png' %}" alt="루피 right">
        </h1>
    </header>
    <main>
        {% block content %}
        {% endblock %}
        <div style="text-align: center;">
            <nav> <!-- 호선 별 페이지 옮기기 -->
                <a href="{% url 'subway:1호선' %}"><img src="{% static 'subway/1.png' %}" style="width: 40px; margin: 8px;"></a>
                <a href="{% url 'subway:2호선' %}"><img src="{% static 'subway/2.png' %}" style="width: 40px; margin: 8px;"></a>
                <a href="{% url 'subway:3호선' %}"><img src="{% static 'subway/3.png' %}" style="width: 40px; margin: 8px;"></a>
                <a href="{% url 'subway:4호선' %}"><img src="{% static 'subway/4.png' %}" style="width: 40px; margin: 8px;"></a>
                <a href="{% url 'subway:5호선' %}"><img src="{% static 'subway/5.png' %}" style="width: 40px; margin: 8px;"></a>
                <a href="{% url 'subway:6호선' %}"><img src="{% static 'subway/6.png' %}" style="width: 40px; margin: 8px;"></a>
                <a href="{% url 'subway:7호선' %}"><img src="{% static 'subway/7.png' %}" style="width: 40px; margin: 8px;"></a>
                <a href="{% url 'subway:8호선' %}"><img src="{% static 'subway/8.png' %}" style="width: 40px; margin: 8px;"></a>
            </nav>
        </div>
    </main>
    <div class="controls"> <!-- 확대 축소 버튼 -->
        <img src="{% static 'subway/zoomin.png' %}" onclick="resizeImage('larger')" style="width: 35px; margin: 5px;">
        <img src="{% static 'subway/zoomout.png' %}" onclick="resizeImage('smaller')" style="width: 35px; margin: 5px;">
    </div>
    {% block script %}
    {% endblock %}
    <script>
        function resizeImage(action) {
            const img = document.querySelector('.map-image');
            let currentWidth = img.style.width ? parseInt(img.style.width) : 120;
            if (action === 'larger') {
                currentWidth = Math.min(currentWidth + 20, 160);
            } else if (action === 'smaller') {
                currentWidth = Math.max(currentWidth - 20, 100);
            }
            img.style.width = currentWidth + '%';
            updateOverlayPosition();
        }

        document.querySelector('.image-container').addEventListener('wheel', function(event) {
            event.preventDefault();
            if (event.deltaY < 0) {
                resizeImage('larger');
            } else {
                resizeImage('smaller');
            }
        })
        
        let isDragging = false;
        let startX, startY, imgStartX, imgStartY;

        const container = document.querySelector('.image-container');
        const img = document.querySelector('.map-image');

        container.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            imgStartX = img.offsetLeft;
            imgStartY = img.offsetTop;
        });

        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                e.preventDefault();
                const dx = (e.clientX - startX);
                const dy = (e.clientY - startY);
                img.style.left = `${imgStartX + dx}px`;
                img.style.top = `${imgStartY + dy}px`;
            }
        });

        document.addEventListener('mouseup', (e) => {
            if (isDragging) {
                isDragging = false;
                updateMarkerPosition();
            }
        });

        document.addEventListener('mouseleave', (e) => {
            if (isDragging) {
                isDragging = false;
                updateMarkerPosition();
            }
        });

        function updateMarkerPosition() {
            const upTrainMarker = document.getElementById('up-train-marker');
            const downTrainMarker = document.getElementById('down-train-marker');
            const imgRect = img.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
        
            const scaleX = imgRect.width / img.naturalWidth;
            const scaleY = imgRect.height / img.naturalHeight;
        
            const markerX = imgRect.left + (initialCoords.x * scaleX) - containerRect.left;
            const markerY = imgRect.top + (initialCoords.y * scaleY) - containerRect.top;
        
            upTrainMarker.style.left = `${markerX}px`;
            upTrainMarker.style.top = `${markerY}px`;
            upTrainMarker.style.transform = `translate(-50%, -50%) scale(${scaleX})`;
        
            downTrainMarker.style.left = `${markerX}px`;
            downTrainMarker.style.top = `${markerY}px`;
            downTrainMarker.style.transform = `translate(-50%, -50%) scale(${scaleX})`;
        }
    </script>
    {% block bet-script %}
    {% endblock %}
</body>
</html>
