{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}기본 타이틀{% endblock %}</title>
    <link rel="stylesheet" type="text/css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        @font-face {
            font-family: 'BMJUA';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_one@1.0/BMJUA.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }
        nav {
            max-width: 500px; /* 원하는 최대 너비 설정 */
            margin: 0 auto; /* 가로로 가운데 정렬 */
            background-color: rgb(235, 238, 243); /* 기존 배경색 유지 */
            border-radius: 10px; /* 선택 사항: 모서리를 둥글게 */
            top: 16.5%;
            left: 33%;
            align-items: center;
            transform: translateY(-55%); /* 얼마나 겹칠지 */
            box-shadow: 3px 3px 7px rgb(183, 185, 185), -3px -3px 7px rgb(183, 185, 185);
            z-index: 2;
            position: fixed;
        }
        
        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgb(255, 226, 236);
            /* z-index: 10; */
            padding-bottom: 25px;
        }
        .header img {
            width: 30px;
        }
        .controls {
            top: 250px;
            right: 20px;
            transform: translateY(-100%);
            display: flex;
            flex-direction: column;
            z-index: 10000;
            position: absolute;
        }
        .image-container {
            width: 1928px;
            height: 1565px;
            max-width: 100%;
            max-height: 80vh;
            overflow: hidden;
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translateY(0%);
            z-index: 1;
        }
        .map-image {
            display: block;
            max-width: none;
            height: auto;
            width: 110%; /* 초기 이미지 확대배율 */
            transition: width 0.5s, transform 0.5s;
            position: absolute;
            object-fit: contain;
            top: 50%;
            left: 50%;
            transform: translate(-60%, -43%);
        }
        .map-image:active {
            cursor: grabbing;
        }
        .overlayImage {
            position: absolute;
            width: 80px;
            height: auto;
            transform-origin: top left;
        }
    </style>
    
</head>

<body>
    <header class="header" style="font-family: 'BMJUA';">
        <h1>
            <img src="{% static 'subway/루피left.png' %}" alt="루피 left">
            <span>당당루피즈 지하철 노선도</span>
            <img src="{% static 'subway/루피right.png' %}" alt="루피 right">
        </h1>
    </header>
    <main>
        {% block content %}
        {% endblock %}
    </main>
    <div style="text-align: center;">
        <nav> <!-- 호선 별 페이지 옮기기 -->
            <a href="{% url 'subway:1호선' %}"><img src="{% static 'subway/1.png' %}" style="width: 40px; margin: 8px;"></a>
            <a href="{% url 'subway:2호선' %}"><img src="{% static 'subway/2.png' %}" style="width: 40px; margin: 8px;"></a>
            <a href="{% url 'subway:3호선' %}"><img src="{% static 'subway/3.png' %}" style="width: 40px; margin: 8px;"></a>
            <a href="{% url 'subway:4호선' %}"><img src="{% static 'subway/4.png' %}" style="width: 40px; margin: 8px;"></a>
            <a href="{% url 'subway:5호선' %}"><img src="{% static 'subway/5.png' %}" style="width: 40px; margin: 8px;"></a>
            <a href="{% url 'subway:6호선' %}"><img src="{% static 'subway/6.png' %}" style="width: 40px; margin: 8px;"></a>
            <a href="{% url 'subway:7호선' %}"><img src="{% static 'subway/7.png' %}" style="width: 40px; margin: 8px;"></a>
            <a href="{% url 'subway:8호선' %}"><img src="{% static 'subway/8.png' %}" style="width: 40px; margin: 8px;"></a>
        </nav>
    </div>
    <div class="controls"> <!-- 확대 축소 버튼 -->
        <img src="{% static 'subway/zoomin.png' %}" onclick="resizeImage('larger')" style="width: 35px; margin: 5px;">
        <img src="{% static 'subway/zoomout.png' %}" onclick="resizeImage('smaller')" style="width: 35px; margin: 5px;">
    </div>
    <script>
        function resizeImage(action) {
            const img = document.querySelector('.map-image');
            let currentWidth = img.style.width ? parseInt(img.style.width) : 120;
            if (action === 'larger') {
                currentWidth = Math.min(currentWidth + 20, 160);
            } else if (action === 'smaller') {
                currentWidth = Math.max(currentWidth - 20, 100);
            }
            img.style.width = currentWidth + '%';
            updateOverlayPosition();
        }

        document.querySelector('.image-container').addEventListener('wheel', function(event) {
            event.preventDefault();
            if (event.deltaY < 0) {
                resizeImage('larger');
            } else {
                resizeImage('smaller');
            }
        })

        const img = document.querySelector('.map-image')
        container.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            imgStartX = img.offsetLeft;
            imgStartY = img.offsetTop;
        })
        
        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                e.preventDefault();
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                img.style.left = `${imgStartX + dx}px`;
                img.style.top = `${imgStartY + dy}px`;
            }
        })
        document.addEventListener('mouseup', () => {
            isDragging = false;
        })
        document.addEventListener('mouseleave', () => {
            isDragging = false;
        })
        const overlayImage = document.getElementById('overlayImage');
        const initialOverlayX = 100;
        const initialOverlayY = 100;
        function updateOverlayPosition() {
            const img = document.querySelector('.map-image');
            const imgRect = img.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            const scale = img.width / img.naturalWidth;
            const overlayX = initialOverlayX * scale + imgRect.left - containerRect.left;
            const overlayY = initialOverlayY * scale + imgRect.top - containerRect.top;
            overlayImage.style.transform = `translate(${overlayX}px, ${overlayY}px) scale(${scale})`;
        } 
        window.addEventListener('load', updateOverlayPosition);
        window.addEventListener('resize', updateOverlayPosition);
        document.querySelector('.map-image').addEventListener('load', updateOverlayPosition);
    </script>
</body>
</html>

